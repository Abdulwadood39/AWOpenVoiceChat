<!--<!DOCTYPE html>-->
<!--<html>-->
<!--    <head>-->
<!--        <title>Chat</title>-->
<!--    </head>-->
<!--    <body>-->
<!--        <h1>WebSocket Chat</h1>-->
<!--        <form action="" onsubmit="sendMessage(event)">-->
<!--            <input type="text" id="messageText" autocomplete="off"/>-->
<!--            <button>Send</button>-->
<!--        </form>-->
<!--        <ul id='messages'>-->
<!--        </ul>-->
<!--        <script>-->
<!--            var ws = new WebSocket("ws://localhost:8000/ws");-->
<!--            ws.onmessage = function(event) {-->
<!--                var messages = document.getElementById('messages')-->
<!--                var message = document.createElement('li')-->
<!--                var content = document.createTextNode(event.data)-->
<!--                message.appendChild(content)-->
<!--                messages.appendChild(message)-->
<!--            };-->
<!--            function sendMessage(event) {-->
<!--                var input = document.getElementById("messageText")-->
<!--                ws.send(input.value)-->
<!--                input.value = ''-->
<!--                event.preventDefault()-->
<!--            }-->
<!--        </script>-->
<!--    </body>-->
<!--</html>-->

<!DOCTYPE html>
<html>
    <head>
        <title>Audio WebSocket Chat</title>
    </head>
    <body>
        <h1>WebSocket Chat</h1>
        <button onclick="startRecording()">Start Recording</button>
        <button onclick="stopRecording()">Stop Recording</button>
        <button onclick="sendMessage()">Send</button>
        <ul id='messages'></ul>
        <script>
            var ws = new WebSocket("ws://localhost:8000/ws");
            var mediaRecorder;
            var audioChunks = [];

            ws.onmessage = function(event) {
                var messages = document.getElementById('messages');
                var message = document.createElement('li');
                var content = document.createTextNode(event.data);
                message.appendChild(content);
                messages.appendChild(message);
            };

            function startRecording() {
                navigator.mediaDevices.getUserMedia({ audio: true })
                    .then(function(stream) {
                        mediaRecorder = new MediaRecorder(stream);
                        mediaRecorder.ondataavailable = function(e) {
                            audioChunks.push(e.data);
                            sendMessage();
                        };
                        mediaRecorder.start(1000);
                    })
                    .catch(function(err) {
                        console.error('Error accessing microphone', err);
                    });
            }

            function stopRecording() {
                if (mediaRecorder.state === 'recording') {
                    mediaRecorder.stop();
                }
            }

            function sendMessage() {
                if (audioChunks.length === 0) {
                    console.error('No audio data recorded.');
                    return;
                }
                var audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                ws.send(audioBlob);
                audioChunks = [];
            }
        </script>
    </body>
</html>
